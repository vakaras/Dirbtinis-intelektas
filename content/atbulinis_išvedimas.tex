\chapter{Atbulinis išvedimas}

\section{Užduotis}

Parašyti programą, kuri, kaip pradinius duomenis gavusi trejetą
$<R, F, G>$, panaudodama atbulinio išvedimo sistemą nustatytų
ar tikslas $G$ yra išvedamas ir jei taip, tai kokias produkcijas
turime pritaikyti, kad jį gautume.

\section{Pseudo kodas}

\label{sec:bc:pseudo}

Pradiniai duomenys:
\begin{description}
  \item[$R$] – taisyklių aibė;
  \item[$F$] – pradinių faktų aibė;
  \item[$G$] – ieškomas tikslas.
\end{description}

Rezultatas:
\begin{description}
  \item[$Q$] – panaudotų taisyklių seka arba „nesėkmė“.
\end{description}

Kiti kintamieji:
\begin{description}
  \item[$K$] – panaudotų taisyklių sekos dalis;
  \item[$P$] – ieškomų tikslų aibė.
\end{description}

\begin{algorithmic}[1]
  \Function{atbulinis išvedimas}{$R, F, G, P := \left\{ G \right\}$}
    \If{$G \in F$} \label{bc:pseudo:goal_in_facts}
      \State \Return $\emptyset$ \label{bc:pseudo:emptyset}
    \Else
      \ForAll{$r \in R \land r$ išvada yra $G \land$ nė viena iš $r$
              prielaidų $\not\in P$} \label{bc:pseudo:rule_iter}
        \State $Q := \left( \right)$ \label{bc:pseudo:initial_Q}
        \ForAll{$g \in r$ prielaidos} \label{bc:pseudo:premise_iter}
          \State $K := $ atbulinis išvedimas$(%
            R\setminus \left\{ r \right\}, F, g,%
            P \cup \left\{ g \right\})$; \label{bc:pseudo:recursion}
          \If{$K =$ nesėkmė} \label{bc:pseudo:rule:fail}
            \State $Q :=$ nesėkmė;
            \State break
          \Else \label{bc:pseudo:rule:success}
            \State $Q := Q \cup K$;
          \EndIf
          \If{$Q \neq$ nesėkmė} \label{bc:pseudo:success}
            \State \Return $Q \cup \left\{ R \right\}$;%
              \label{bc:pseudo:return_succ}
          \EndIf
        \EndFor
      \EndFor
      \State \Return nesėkmė; \label{bc:pseudo:failure}
    \EndIf
  \EndFunction
\end{algorithmic}

\section{Realizacija}

Atbulinio išvedimo algoritmo, pateikto \ref{sec:fc:pseudo}
skyrelyje, realizacija:

\pythonai{source}{forwardchaining.ForwardChaining.recursion}

\section{Pavyzdžiai}

\subsection{Pirmasis pavyzdys: paprastas atvejis}

\begin{pythonaienv}[bc]
# Taisyklės:
FB Z                                    # R1: F, B → Z
CD F                                    # R2: C, D → F
A D                                     # R3: A → D
# Faktai:
ABC
# Tikslas:
Z
\end{pythonaienv}

\subsection{Antrasis pavyzdys: du išvedimo keliai}

\begin{pythonaienv}[bc]
# Taisyklės:
D Z                                     # R1: D → Z
C D                                     # R2: C → D
B C                                     # R3: B → C
A G                                     # R4: A → G
G Z                                     # R5: G → Z
A B                                     # R6: A → B
# Faktai:
A
# Tikslas:
Z
\end{pythonaienv}

\subsection{Trečiasis pavyzdys: du išvedimo keliai (taisyklės kita tvarka)}

\begin{pythonaienv}[bc]
# Taisyklės:
A G                                     # R1: A → G
D Z                                     # R2: D → Z
C D                                     # R3: C → D
B C                                     # R4: B → C
A B                                     # R5: A → B
G Z                                     # R6: G → Z
# Faktai:
A
# Tikslas:
Z
\end{pythonaienv}

\subsection{Ketvirtasis pavyzdys: klaidinančios taisyklės}

\begin{pythonaienv}[bc]
# Taisyklės:
Z Z                                     # R1:  Z → Z
VA Z                                    # R2:  V, A → Z
VAZ Z                                   # R3:  V, A, Z → Z
ABCDEFGHIJKLMNOPRST Z                   # R4:  … → Z
FB Z                                    # R5:  F, B → Z
CD F                                    # R6:  C, D → F
A D                                     # R7:  A → D
A L                                     # R8:  A → L
L K                                     # R9:  L → K
B A                                     # R10: B → A
D M                                     # R11: D → M
# Faktai:
ABC
# Tikslas:
Z
\end{pythonaienv}

\subsection{Penktasis pavyzdys: ilgas antecedentas}

\begin{pythonaienv}[bc]
# Taisyklės:
G Z                                     # R1: G → Z
A G                                     # R2: A → G
A B                                     # R3: A → B
B C                                     # R4: B → C
C D                                     # R5: C → D
D Z                                     # R6: D → Z
ABGCDZ H                                # R7: A, B, C, D, G, Z → H
# Faktai:
A
# Tikslas:
H
\end{pythonaienv}

\subsection{Šeštasis pavyzdys: išvedimas neegzistuoja}

\begin{pythonaienv}[bc]
# Taisyklės:
CD F                                    # R1: C, D → F
A D                                     # R2: A → D
A L                                     # R3: A → L
L K                                     # R4: L → K
B A                                     # R5: B → A
D M                                     # R6: D → M
FB Z                                    # R7: F, B → Z
# Faktai:
ABC
# Tikslas:
H
\end{pythonaienv}

\subsection{Septintasis pavyzdys: tikslas tarp prielaidų}

\begin{pythonaienv}[bc]
# Taisyklės:
CD F                                    # R1: C, D → F
A D                                     # R2: A → D
A L                                     # R3: A → L
L K                                     # R4: L → K
B A                                     # R5: B → A
D M                                     # R6: D → M
FB Z                                    # R7: F, B → Z
# Faktai:
ABC
# Tikslas:
B
\end{pythonaienv}
